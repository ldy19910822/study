!function(window,document,undefined){for(var globalOption={VERSION:.12,FIRST_OPERATION_THRESHOLD:2e4,LOAD_THRESHOLD:1e5,UPLOAD_ROOT_PATH:"http://api.perf.netease.com/api/Rum/",clientStart:+new Date,geolocation:!1,frameMonitor:!1,xhrMonitor:!1,log:!1},params=window._rum||[],i=0;i<params.length;i++){var param=params[i];switch(param[0]){case"page":globalOption.page=param[1]||"";break;case"frameMonitor":globalOption.frameMonitor=!!param[1];break;case"xhrMonitor":globalOption.xhrMonitor=!!param[1];break;case"geolocation":globalOption.geolocation=!!param[1];break;case"log":globalOption.log=!!param[1];break;case"firstByte":globalOption.timeFirstByte=param[1]||0;break;case"onload":globalOption.timeOnload=param[1]||0}}window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){setTimeout(a,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout,Util=function(){window.JSON||(window.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:function(a){if(a instanceof Object){var b="";if(a.constructor===Array){for(var c=0;c<a.length;b+=this.stringify(a[c])+",",c++);return"["+b.substr(0,b.length-1)+"]"}if(a.toString!==Object.prototype.toString)return'"'+a.toString().replace(/"/g,"\\$&")+'"';for(var d in a)b+='"'+d.replace(/"/g,"\\$&")+'":'+this.stringify(a[d])+",";return"{"+b.substr(0,b.length-1)+"}"}return"string"==typeof a?'"'+a.replace(/"/g,"\\$&")+'"':String(a)}});var timeNow=function(){return+new Date-globalOption.clientStart},performanceNow=function(){var a;if(window.performance&&"function"==typeof window.performance.now)a=performance.now();else{var b=Util.findStartTimeFromCookie();b||(b=globalOption.timeFirstByte-100),a=+new Date-b}return Math.round(1e3*(a||0))/1e3},forEach=function(a,b,c){if(a instanceof Array)for(var d=0;d<a.length;d++)b.call(c,a[d],d);else if(a instanceof Object)for(var e in a)b.call(c,a[e],e);return a},getEventElement=function(a){return a=a||window.event,a.srcElement||a.target},stopEvent=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},addEvent=document.addEventListener?function(a,b,c,d){a.addEventListener(b,c,d)}:function(a,b,c){a.attachEvent("on"+b,c)},delEvent=document.removeEventListener?function(a,b,c,d){a.removeEventListener(b,c,d)}:function(a,b,c){a.detachEvent("on"+b,c)},READY_STATE_RE=/^(?:loaded|complete|undefined)$/,jsonpReq=function(a,b){var c=document.createElement("script"),d=function(){READY_STATE_RE.test(c.readyState)&&(document.body.removeChild(c),b())};return c.type="text/javascript",c.src=a,c.onload=c.onerror=c.onreadystatechange=d,document.body.appendChild(c),d},bind=function(a,b){var c=arguments.length>2?[].slice.call(arguments,2):[];return"function"!=typeof b||b instanceof RegExp?b:c.length?function(){return arguments.length?b.apply(a,c.concat([].slice.call(arguments,0))):b.apply(a,c)}:function(){return arguments.length?b.apply(a,arguments):b.call(a)}},log=function(a){globalOption.log&&window.console&&console.log("string"==typeof a?a:JSON.stringify(a))},getRandomNumber=function(a){return a=a||8,Math.round(Math.random()*Math.pow(10,a))},resolveURL=function(a,b){if(/^https?:/.test(a))return a;var c=document.createElement("a"),d=document.createElement("a");if(c.href=b,d.href=a,d.protocol=c.protocol,/^\/\//.test(a)||(d.hostname=c.hostname),/^\//.test(a))return d.href;var e=a.split(/\//),f=c.pathname.split(/\//);for(/\/$/.test(b)||f.pop();".."==e[0];)f.pop(),e.shift();return d.pathname=f.join("/")+"/"+e.join("/"),d.href},getResourceDuration=function(a){var a=resolveURL(a,location.href);if(window.performance&&window.performance.getEntriesByName){var b=window.performance.getEntriesByName(a);return 0==b.length?(log(a),-1):1==b.length?Math.round(b[0].duration):Math.round(b[b.length-1].duration)}return-2},findStartTimeFromCookie=function(){for(var a=document.cookie.split(" "),b=0;b<a.length;b++)if(0===a[b].indexOf("RUM=")){for(var d,e,c=a[b].substring("RUM=".length).split("&"),f=0;f<c.length;f++)if(0===c[f].indexOf("s="))d=c[f].substring(2);else if(0===c[f].indexOf("r=")){var g=c[f].substring(2);e=escape(document.referrer)==g}if(e&&d)return Util.log("findStartTimeFromCookie: startTime = "+d),d}return undefined};return{forEach:forEach,addEvent:addEvent,delEvent:delEvent,getEventElement:getEventElement,stopEvent:stopEvent,jsonpReq:jsonpReq,bind:bind,log:log,timeNow:timeNow,performanceNow:performanceNow,resolveURL:resolveURL,getResourceDuration:getResourceDuration,getRandomNumber:getRandomNumber,findStartTimeFromCookie:findStartTimeFromCookie}}();var PubSub=function(){this._listeners=[]};PubSub.prototype={add:function(a){this._listeners.push(a)},remove:function(a){for(var b=this._listeners.length-1;b>=0;b--)this._listeners[b]===a&&this._listeners.splice(b,1)},each:function(a){Util.forEach(this._listeners,a)},removeAll:function(){this._listeners=[]}};var EVENT_TYPES={DOMEVENT:"de",MARK:"mk",MARKSTART:"ms",MARKEND:"me",AJAXSTART:"axs",AJAXEND:"axe",AJAXSCRIPTEND:"axse",AJAXNETWORK:"axn"},frameMonitor={isRunning:!1,interval:Math.round(1e3/60),events:[],index:0,handlers:new PubSub,_frameHandler:function(){var c,a=Util.timeNow();c={index:this.index++,tspan:Math.round(a-this.lastTime-this.interval),tbegin:this.lastTime,interval:this.interval,events:this.events},this.events=[],this.handlers.each(function(a){a(c)}),this.lastTime=a,this._nextFrame()},_nextFrame:function(){this.isRunning&&(this.nextTimeout=window.requestAnimationFrame(Util.bind(this,this._frameHandler)))},isRun:function(){return this.isRunning},addEvent:function(a,b,c){if(this.isRunning){var d=Util.timeNow(),e={data:c,time:d,type:a,name:b};return this.events.push(e),e}},addHandler:function(a){"function"==typeof a&&this.handlers.add(a)},removeHandler:function(a){"function"==typeof a&&this.handlers.remove(a)},startup:function(){this.isRunning&&this.end(),this.pauseOrRestart()},pauseOrRestart:function(){this.isRunning?(this.isRunning=!1,window.cancelAnimationFrame(this.nextTimeout)):(this.isRunning=!0,this.lastTime=Util.timeNow(),this._nextFrame())},end:function(){this.isRunning=!1,this.handlers.removeAll(),window.cancelAnimationFrame(this.nextTimeout)}};window.$performance&&"function"==typeof $performance.all&&(globalOption.performanceData=$performance.all()),window.$performance=function(){var a=function(a){a&&(globalOption.geolocation=!!a.geolocation,globalOption.frameMonitor=!!a.frameMonitor,globalOption.log=!!a.log),frameMonitor.startup(),globalOption.geolocation&&upload.getGeolocation();var b=globalOption.performanceData;b&&b.length&&b.length>0&&Util.forEach(b,function(a){var b=a[0],c=a[1];switch(b){case"mark":var d=c.now;d||(d=c.time-Util.findStartTimeFromCookie()),c.name&&d&&$performance.mark(c.name,!1,{time:Math.round(1e3*(d||0))/1e3})}})},b=function(a,b,c){var d=Util.getRandomNumber(),e={name:a,time:Util.performanceNow()};return b&&(e.monitor=b),c&&(e.data=c),c&&c.time&&(e.time=c.time),frameMonitor.addEvent(EVENT_TYPES.MARK,d,e),d},c=function(a){var b=Util.getRandomNumber();return frameMonitor.addEvent(EVENT_TYPES.MARKSTART,b,{name:a,time:Util.performanceNow()}),b},d=function(a,b,c){if(a&&"number"==typeof a){var d={};b&&(d.monitor=!!b),c&&(d.data=c),frameMonitor.addEvent(EVENT_TYPES.MARKEND,a,d)}},e=function(a){var b=Util.getRandomNumber();return frameMonitor.addEvent(EVENT_TYPES.AJAXSTART,b,{url:a,time:Util.performanceNow()}),b},f=function(a){return frameMonitor.addEvent(EVENT_TYPES.AJAXEND,a,{id:a}),a},g=function(a,b,c){if(a&&"number"==typeof a){var d={};b&&(d.monitor=b),c&&(d.data=c),frameMonitor.addEvent(EVENT_TYPES.AJAXSCRIPTEND,a,d)}},h=function(a,b){frameMonitor.addEvent(EVENT_TYPES.AJAXNETWORK,a,{duration:b})};return{version:globalOption.version,EVENT_TYPES:EVENT_TYPES,startup:a,mark:b,markStart:c,markEnd:d,ajaxStart:e,ajaxEnd:f,ajaxScriptEnd:g,ajaxNetwork:h}}();var upload=function(){function j(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){g.location.push(a.coords.latitude),g.location.push(a.coords.longitude)})}function k(){document.cookie="RUM=s="+Number(new Date)+"&r="+escape(document.location)+"; path=/"}function l(){globalOption.timeOnload||(globalOption.timeOnload=+new Date);var a=Util.performanceNow();a<globalOption.LOAD_THRESHOLD&&$performance.mark("load"),window.setTimeout(m,0)}function m(){function h(){var a=window.chrome.loadTimes();0!==a.firstPaintTime?(b.timing.push(Math.round(1e3*a.firstPaintTime)),b.timing.push(Math.round(1e3*a.firstPaintAfterLoadTime)),o()):window.setTimeout(h,d)}var b=g.performance,e=g.performanceOld;if(a)b.navigation.push(window.performance.navigation.type),b.navigation.push(window.performance.navigation.redirectCount),Util.forEach(c,function(a){b.timing.push(window.performance.timing[a]||"")}),performance.timing.msFirstPaint&&b.timing.push(performance.timing.msFirstPaint);else{var f=Util.findStartTimeFromCookie();f&&(e.push(f),e.push(globalOption.timeFirstByte||0),e.push(globalOption.timeOnload||0))}window.chrome&&"function"==typeof window.chrome.loadTimes?h():o()}function o(){!n&&globalOption.page&&(Util.log(JSON.stringify(g)),Util.log(encodeURIComponent(JSON.stringify(g)).length),Util.jsonpReq(globalOption.UPLOAD_ROOT_PATH+"uploadPerformance?performanceData="+encodeURIComponent(JSON.stringify(g)),function(){i=window.$$_RUM_Object_Id,p()}),n=!0)}function p(){if(h.length>0&&i){var a=encodeURIComponent(JSON.stringify(h)),b=[];if(Util.log("1:"+a.length),Util.log(JSON.stringify(h)),a.length>1500){for(var c=h.length,d=0;c>d;d++){b.push(h.shift());var e=encodeURIComponent(JSON.stringify(b));if(e.length>1500&&d>0){h.unshift(b.pop());break}}a=encodeURIComponent(JSON.stringify(b)),Util.log("2:"+a.length),f=0}else b=h,h=[],f=5e3;Util.jsonpReq(globalOption.UPLOAD_ROOT_PATH+"uploadPerformanceFrame?id="+i+"&frames="+encodeURIComponent(JSON.stringify(b)),function(){q()})}else q()}function q(){window.setTimeout(p,f)}var i,a=window.performance,c=(window.performance&&window.performance.getEntries,["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"]),d=3e3,e=12e5,f=5e3,g={page:globalOption.page,clientStart:globalOption.clientStart,frameMonitor:globalOption.frameMonitor,url:window.location.href,platform:window.navigator.platform,userAgent:window.navigator.userAgent,performance:{navigation:[],timing:[]},performanceOld:[],location:[]},h=[];frameMonitor.addHandler(function(a){if(a.tbegin<e&&(globalOption.frameMonitor&&a.tspan+a.interval>50||a.events.length>0)){var b=[a.index,a.tspan,a.tbegin];if(a.events.length>0){var c=[];Util.forEach(a.events,function(a){a.data?c.push([a.type,a.name,a.time,a.data]):c.push([a.type,a.name,a.time])}),b.push(c)}h.push(b)}});var n=!1;return"complete"==document.readyState?l():Util.addEvent(window,"load",l),Util.addEvent(window,"beforeunload",k),{getGeolocation:j}}();!function(){function a(a){var b=Util.getEventElement(a),c="",d=Util.performanceNow(),e={};for(!globalOption.firstOperation&&d<globalOption.FIRST_OPERATION_THRESHOLD&&($performance.mark("firstOperation"),globalOption.firstOperation=!0);b&&b!=document;){if(b.getAttribute("operation")){c=b.getAttribute("operation");break}b=b.parentNode}b.id&&(e.id=b.id),c&&$performance.mark(c,!0,e)}function b(){var b=Util.performanceNow();!globalOption.firstOperation&&b<globalOption.FIRST_OPERATION_THRESHOLD&&($performance.mark("firstOperation"),globalOption.firstOperation=!0)}function c(){"hidden"==document.visibilityState?frameMonitor.pauseOrRestart():"visible"==document.visibilityState&&frameMonitor.pauseOrRestart()}if(Util.addEvent(document,"click",a,!0),Util.addEvent(document,"scroll",b,!0),Util.addEvent(document,"visibilitychange",c,!0),globalOption.xhrMonitor&&window.XMLHttpRequest&&window.XMLHttpRequest.prototype){var d=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){this.$rawUrl=arguments[1],this.$url=arguments[1].split("?")[0],d.apply(this,arguments)};var e=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){var a=$performance.ajaxStart(this.$url),b=this.onreadystatechange;this.onreadystatechange=function(){4==this.readyState?($performance.ajaxEnd(a),this.onreadystatechange=b,b.apply(this,arguments),$performance.ajaxScriptEnd(a,!0,{status:this.status}),window.setTimeout(function(a,b){return function(){var c=Util.getResourceDuration(b);$performance.ajaxNetwork(a,c)}}(a,this.$rawUrl),0)):b.apply(this,arguments)},e.apply(this,arguments)}}}()}(window,document),$performance.startup();